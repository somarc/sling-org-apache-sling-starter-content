<!--
Licensed to the Apache Software Foundation (ASF) under one
or more contributor license agreements.  See the NOTICE file
distributed with this work for additional information
regarding copyright ownership.  The ASF licenses this file
to you under the Apache License, Version 2.0 (the
"License"); you may not use this file except in compliance
with the License.  You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing,
software distributed under the License is distributed on an
"AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, either express or implied.  See the License for the
specific language governing permissions and limitations
under the License.
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blockchain AEM - Decentralized Content Repository</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .tagline {
            color: #666;
            font-size: 1.1rem;
        }

        .wallet-info {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .wallet-info h2 {
            color: #333;
            margin-bottom: 15px;
            font-size: 1.5rem;
        }

        .wallet-id {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            color: #2d3748;
            word-break: break-all;
        }

        .grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        @media (max-width: 968px) {
            .grid {
                grid-template-columns: 1fr;
            }
        }

        .card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .card h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
        }

        input, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus, textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        textarea {
            min-height: 100px;
            font-family: inherit;
            resize: vertical;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 14px 28px;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            width: 100%;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        button:active {
            transform: translateY(0);
        }

        button.secondary {
            background: linear-gradient(135deg, #f56565 0%, #c53030 100%);
        }

        .chain-content {
            grid-column: 1 / -1;
        }

        .content-list {
            list-style: none;
        }

        .content-item {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .content-item:hover {
            background: #edf2f7;
        }

        .content-path {
            font-family: 'Courier New', monospace;
            color: #2d3748;
        }

        .status-badge {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            font-weight: 600;
        }

        .status-published {
            background: #48bb78;
            color: white;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.success {
            background: #c6f6d5;
            color: #22543d;
            border-left: 4px solid #48bb78;
        }

        .alert.error {
            background: #fed7d7;
            color: #742a2a;
            border-left: 4px solid #f56565;
        }

        .alert.show {
            display: block;
        }

        .stats {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }

        .stat {
            flex: 1;
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
        }

        .stat-label {
            color: #718096;
            font-size: 0.875rem;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚õìÔ∏è Blockchain AEM</h1>
            <p class="tagline">Decentralized Content Repository on Oak + Ethereum</p>
            <div style="margin-top: 20px;">
                <a href="oak-chain-publish.html" style="display: inline-block; padding: 12px 24px; background: linear-gradient(135deg, #f6851b 0%, #e2761b 100%); color: white; text-decoration: none; border-radius: 8px; font-weight: 600; box-shadow: 0 4px 12px rgba(246, 133, 27, 0.3);">
                    ü¶ä Pay with MetaMask ‚Üí Publish to Oak Chain
                </a>
            </div>
        </header>

        <div class="wallet-info">
            <h2>üîê Your Wallet</h2>
            <div class="wallet-id" id="walletId">Loading...</div>
            <div class="stats">
                <div class="stat">
                    <div class="stat-value" id="publishCount">0</div>
                    <div class="stat-label">Published</div>
                </div>
                <div class="stat">
                    <div class="stat-value" id="nodeCount">0</div>
                    <div class="stat-label">Nodes</div>
                </div>
                <div class="stat">
                    <div class="stat-value">POC</div>
                    <div class="stat-label">Network</div>
                </div>
            </div>
        </div>

        <div class="grid">
            <div class="card">
                <h2>üì§ Publish to Chain</h2>
                <div class="alert success" id="publishSuccess"></div>
                <div class="alert error" id="publishError"></div>
                <form id="publishForm">
                    <div class="form-group">
                        <label for="publishPath">Content Path</label>
                        <input type="text" id="publishPath" placeholder="/my-content" required>
                    </div>
                    <div class="form-group">
                        <label for="publishTitle">Title</label>
                        <input type="text" id="publishTitle" placeholder="My Amazing Content" required>
                    </div>
                    <div class="form-group">
                        <label for="publishContent">Content</label>
                        <textarea id="publishContent" placeholder="Enter your content here..." required></textarea>
                    </div>
                    <button type="submit">Publish to Global Store</button>
                </form>
            </div>

            <div class="card">
                <h2>üóëÔ∏è Unpublish from Chain</h2>
                <div class="alert success" id="unpublishSuccess"></div>
                <div class="alert error" id="unpublishError"></div>
                <form id="unpublishForm">
                    <div class="form-group">
                        <label for="unpublishPath">Content Path</label>
                        <input type="text" id="unpublishPath" placeholder="/oak-chain/content/..." required>
                    </div>
                    <button type="submit" class="secondary">Unpublish from Global Store</button>
                </form>
            </div>
        </div>

        <div class="card chain-content">
            <h2>üîç Browse Global Chain</h2>
            <p style="color: #666; margin-bottom: 20px;">Connect to the GlobalStoreServer and view the genesis content via HTTP Segment Transfer</p>
            <button onclick="browseGlobalChain()" style="width: auto; margin-bottom: 20px;">
                üåê Load Genesis Content from Global Store
            </button>
            <div id="globalChainStatus" class="alert" style="display: none;"></div>
            <div id="globalChainContent" style="display: none;">
                <h3 style="margin: 20px 0 10px 0; color: #333;">Connection Status</h3>
                <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px;">
                    <div style="display: grid; grid-template-columns: 150px 1fr; gap: 10px;">
                        <strong>Server URL:</strong> <span id="serverUrl" style="font-family: monospace;"></span>
                        <strong>Status:</strong> <span id="serverStatus"></span>
                        <strong>Protocol:</strong> <span id="serverProtocol"></span>
                    </div>
                </div>
                
                <h3 style="margin: 20px 0 10px 0; color: #333;">Genesis Content</h3>
                <div style="background: #f7fafc; padding: 15px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid #48bb78;">
                    <div style="display: grid; grid-template-columns: 150px 1fr; gap: 10px;">
                        <strong>Path:</strong> <span id="genesisPath" style="font-family: monospace;"></span>
                        <strong>Message:</strong> <span id="genesisMessage" style="font-size: 1.2rem; font-weight: 600; color: #667eea;"></span>
                        <strong>Description:</strong> <span id="genesisDescription"></span>
                        <strong>Author:</strong> <span id="genesisAuthor"></span>
                        <strong>Version:</strong> <span id="genesisVersion"></span>
                        <strong>Storage:</strong> <span id="genesisNote" style="font-size: 0.9rem; color: #666;"></span>
                    </div>
                </div>
                
                <h3 style="margin: 20px 0 10px 0; color: #333;">Capabilities</h3>
                <div style="background: #f7fafc; padding: 15px; border-radius: 8px;">
                    <ul id="capabilitiesList" style="list-style: none;">
                        <!-- Populated by JavaScript -->
                    </ul>
                </div>
            </div>
        </div>

        <div class="card chain-content">
            <h2>üåê Content on Global Chain</h2>
            <ul class="content-list" id="chainContentList">
                <li class="content-item">
                    <span class="content-path">/oak-chain/content/genesis (DO IT LIVE!)</span>
                    <span class="status-badge status-published">GENESIS BLOCK</span>
                </li>
            </ul>
        </div>
    </div>

    <script>
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Generate a mock wallet ID for POC
            const walletId = generateMockWalletId();
            document.getElementById('walletId').textContent = walletId;

            // Publish form handler
            document.getElementById('publishForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const path = document.getElementById('publishPath').value;
                const title = document.getElementById('publishTitle').value;
                const content = document.getElementById('publishContent').value;

                const successAlert = document.getElementById('publishSuccess');
                const errorAlert = document.getElementById('publishError');
                successAlert.classList.remove('show');
                errorAlert.classList.remove('show');

                try {
                    const response = await fetch('/bin/blockchain/publish', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: `path=${encodeURIComponent(path)}&title=${encodeURIComponent(title)}&content=${encodeURIComponent(content)}`
                    });

                    const result = await response.json();

                    if (result.success) {
                        successAlert.textContent = `‚úÖ Published to: ${result.path}`;
                        successAlert.classList.add('show');
                        document.getElementById('publishForm').reset();
                        updateStats();
                        setTimeout(() => successAlert.classList.remove('show'), 5000);
                    } else {
                        errorAlert.textContent = `‚ùå Error: ${result.error}`;
                        errorAlert.classList.add('show');
                    }
                } catch (error) {
                    errorAlert.textContent = `‚ùå Network error: ${error.message}`;
                    errorAlert.classList.add('show');
                }
            });

            // Unpublish form handler
            document.getElementById('unpublishForm').addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const path = document.getElementById('unpublishPath').value;
                
                const successAlert = document.getElementById('unpublishSuccess');
                const errorAlert = document.getElementById('unpublishError');
                successAlert.classList.remove('show');
                errorAlert.classList.remove('show');

                try {
                    const response = await fetch('/bin/blockchain/unpublish', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded',
                        },
                        body: `path=${encodeURIComponent(path)}&walletId=${encodeURIComponent(walletId)}`
                    });

                    const result = await response.json();

                    if (result.success) {
                        successAlert.textContent = `‚úÖ Unpublished: ${result.path}`;
                        successAlert.classList.add('show');
                        document.getElementById('unpublishForm').reset();
                        updateStats();
                        setTimeout(() => successAlert.classList.remove('show'), 5000);
                    } else {
                        errorAlert.textContent = `‚ùå Error: ${result.error}`;
                        errorAlert.classList.add('show');
                    }
                } catch (error) {
                    errorAlert.textContent = `‚ùå Network error: ${error.message}`;
                    errorAlert.classList.add('show');
                }
            });
        });

        function generateMockWalletId() {
            // Generate a mock wallet ID for POC (in production, this would be from actual wallet)
            const bytes = new Uint8Array(20);
            crypto.getRandomValues(bytes);
            return '0x' + Array.from(bytes).map(b => b.toString(16).padStart(2, '0')).join('');
        }

        function updateStats() {
            // Increment publish count
            const countEl = document.getElementById('publishCount');
            countEl.textContent = parseInt(countEl.textContent) + 1;
        }

        async function browseGlobalChain() {
            const statusEl = document.getElementById('globalChainStatus');
            const contentEl = document.getElementById('globalChainContent');
            
            // Show loading
            statusEl.className = 'alert';
            statusEl.textContent = '‚è≥ Connecting to GlobalStoreServer via HTTP Segment Transfer...';
            statusEl.style.display = 'block';
            statusEl.style.background = '#e6fffa';
            statusEl.style.color = '#234e52';
            statusEl.style.borderLeft = '4px solid #38b2ac';
            contentEl.style.display = 'none';

            try {
                const response = await fetch('/bin/blockchain/browse');
                const data = await response.json();

                if (data.status === 'CONNECTED') {
                    // Success - show genesis content
                    statusEl.className = 'alert success';
                    statusEl.textContent = '‚úÖ ' + data.message;
                    statusEl.style.display = 'block';
                    
                    // Populate connection status
                    document.getElementById('serverUrl').textContent = data.globalStore.url;
                    document.getElementById('serverStatus').innerHTML = 
                        `<span style="color: #48bb78; font-weight: 600;">‚óè CONNECTED</span>`;
                    document.getElementById('serverProtocol').textContent = data.globalStore.protocol;
                    
                    // Populate genesis content
                    document.getElementById('genesisPath').textContent = data.genesis.path;
                    document.getElementById('genesisMessage').textContent = data.genesis.message;
                    document.getElementById('genesisDescription').textContent = data.genesis.description;
                    document.getElementById('genesisAuthor').textContent = data.genesis.author;
                    document.getElementById('genesisVersion').textContent = data.genesis.version;
                    document.getElementById('genesisNote').textContent = data.genesis.note;
                    
                    // Populate capabilities
                    const capList = document.getElementById('capabilitiesList');
                    capList.innerHTML = '';
                    if (data.capabilities) {
                        const caps = [
                            { key: 'httpSegmentTransfer', label: 'HTTP Segment Transfer', value: data.capabilities.httpSegmentTransfer },
                            { key: 'genesisContent', label: 'Genesis Content', value: data.capabilities.genesisContent },
                            { key: 'byodModel', label: 'BYOD Binary Storage', value: data.capabilities.byodModel },
                        ];
                        caps.forEach(cap => {
                            const li = document.createElement('li');
                            li.style.padding = '8px 0';
                            li.innerHTML = `<span style="color: ${cap.value ? '#48bb78' : '#f56565'}; font-weight: 600;">` +
                                `${cap.value ? '‚úì' : '‚úó'}</span> ${cap.label}`;
                            capList.appendChild(li);
                        });
                        // Add consensus protocol
                        const protocolLi = document.createElement('li');
                        protocolLi.style.padding = '8px 0';
                        protocolLi.innerHTML = `<strong>Consensus:</strong> ${data.capabilities.consensusProtocol}`;
                        capList.appendChild(protocolLi);
                    }
                    
                    // Show content
                    contentEl.style.display = 'block';
                    
                    // Update node count stat
                    document.getElementById('nodeCount').textContent = '1';
                    
                    // Hide status after 3 seconds
                    setTimeout(() => {
                        statusEl.style.display = 'none';
                    }, 3000);
                    
                } else if (data.status === 'DISCONNECTED') {
                    // Connection failed
                    statusEl.className = 'alert error';
                    statusEl.textContent = '‚ùå ' + data.message;
                    if (data.troubleshooting) {
                        statusEl.innerHTML += `<br><br><strong>Troubleshooting:</strong><br>` +
                            `<code style="background: white; padding: 2px 8px; border-radius: 4px; display: block; margin-top: 5px;">` +
                            `${data.troubleshooting.checkServer}</code>`;
                    }
                } else {
                    // Error
                    statusEl.className = 'alert error';
                    statusEl.textContent = '‚ùå Error: ' + (data.message || 'Unknown error');
                }
                
            } catch (error) {
                statusEl.className = 'alert error';
                statusEl.textContent = '‚ùå Network error: ' + error.message;
                statusEl.style.display = 'block';
            }
        }
    </script>
</body>
</html>

